<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PingPong Game</title>
  </head>
  <body>
    <section style="display: flex; justify-content: center">
      <div>
        <h1>Ping Pong Game</h1>
        <canvas
          id="canvas"
          height="600"
          width="600"
          style="border: 1px solid black"
          >Heyyy canvas is not supported</canvas
        >
      </div>
    </section>
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const canvasH = canvas.height;
      const canvasW = canvas.width;

      let img = new Image()
      img.src = "level 1.png"
      img.onload = () => {
      ctx.drawImage(img, 34, 69)
      }

      let paddle = { h: 100, w: 5 };
      let leftPaddle = (rightPaddle = ball = {});
      let score = 5;
      let level = 1;
      let increment = 0.2;
      let levelcolor='';

      setInitialVariables(2);
      drawBall();
      drawLeftPaddle();
      drawRightPaddle();
      drawScore();
      drawCenterLine();
      moveBall();
      moveLeftPaddle();

      function setInitialVariables(dx1) {
        ball = { x: 150, y: 150, r: 10, dx: dx1, dy: 1 };
        leftPaddle = { x: 0, y: 125 };
        rightPaddle = { x: canvasW - 5, y: 125 };
      }

      function moveLeftPaddle() {
        document.addEventListener("mousemove", (e) => {
          leftPaddle.y = e.screenY - 200;
        });
      }

      function detectCollision() {
        //   Detect Right Paddle Collision
        if (ball.x > rightPaddle.x - ball.r) {
          ball.dx = -ball.dx;
        }

        //   Detect Left Paddle Collision
        if (
          ball.x < 0 + ball.r + paddle.w &&
          ball.y > leftPaddle.y &&
          ball.y < leftPaddle.y + paddle.h
        ) {
          if(level==1)
          {
            ball.dx = -ball.dx;
            ball.dy;            
          }

          else if(level==2)
          {
            ball.dx = -ball.dx + 2 * increment;
            ball.dy += increment;
          }

          else if(level==3)
          {
            ball.dx = -ball.dx + 5 * increment;
            ball.dy += 2*increment;
          }

          score++;
          if(score>=5 && score <10) level=2;
          if(score>=10) level=3;
        }

        // Detect Top or Bottom Collision
        if (ball.y > canvasH - ball.r || ball.y < 0 + ball.r) {
          ball.dy = -ball.dy;
        }

        // Detect Left Collision
        if (ball.x < 0 + ball.r) {
          alert("You Lose !");
          score=0;
          setInitialVariables(2);
        }
      }

      function moveBall() {

        if(level==1)
        {
        ball.x += ball.dx;
        ball.y += ball.dy;

        if(ball.dx==0) 
        {
          ball.dx=-5;         
        }
        }

        else
        {
        ball.dx+= Math.random() * 0.1;
        ball.dy+= Math.random() * 0.1;
        ball.x += ball.dx;
        ball.y += ball.dy;

        if(ball.dx==0) 
        {
          ball.dx=-5; 
        }
        }

        rightPaddle.y = ball.y - paddle.h / 2;

        ctx.clearRect(0, 0, canvasW, canvasH);

        detectCollision();

        drawBall();
        drawScore();
        drawCenterLine();
        drawLeftPaddle();
        drawRightPaddle();

        requestAnimationFrame(moveBall);
      }

      function drawRightPaddle() {
        ctx.beginPath();
        ctx.setLineDash([]);
        ctx.rect(rightPaddle.x, rightPaddle.y, paddle.w, paddle.h);
        ctx.strokeStyle = levelcolor;
        ctx.stroke();
        ctx.fillStyle = levelcolor;
        ctx.fill();
        ctx.closePath();
      }
      function drawLeftPaddle() {
        ctx.beginPath();
        ctx.setLineDash([]);
        ctx.rect(leftPaddle.x, leftPaddle.y, paddle.w, paddle.h);
        ctx.strokeStyle = levelcolor;
        ctx.stroke();
        ctx.fillStyle = levelcolor;
        ctx.fill();
        ctx.closePath();
      }

      function drawBall() {
        ctx.beginPath();
        ctx.setLineDash([]);
        ctx.arc(ball.x, ball.y, ball.r, 0, 2 * Math.PI);
        if(level==1)
        {
          levelcolor='green'
        } 

        else if(level == 2)
        {
          levelcolor='red';
        } 

        else if(level ==3)
        {
          levelcolor='blue'
        } 

        ctx.strokeStyle = levelcolor;
        ctx.stroke();
        ctx.fillStyle = levelcolor;
        ctx.fill();


        ctx.closePath();
      }

      function drawScore() {
        ctx.beginPath();
        ctx.fillStyle = "#000";
        ctx.fill();
        ctx.fillText("Score: " + score, 20, 10);
        ctx.fillText("X velocity: " + ball.dx, 20, 20);
        ctx.fillText("Y velocity: " + ball.dy, 20, 30);
        ctx.closePath();
      }

      function drawCenterLine() {
        ctx.beginPath();
        ctx.setLineDash([5, 5]);
        ctx.moveTo(canvasW / 2, 0);
        ctx.lineTo(canvasW / 2, canvasH);
        ctx.stroke();
        ctx.closePath();
      }
    </script>
  </body>
</html>